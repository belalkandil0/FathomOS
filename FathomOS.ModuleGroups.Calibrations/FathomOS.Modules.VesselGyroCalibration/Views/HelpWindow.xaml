<mah:MetroWindow x:Class="FathomOS.Modules.VesselGyroCalibration.Views.HelpWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        Title="Vessel Gyro Calibration - User Guide"
        Height="700" Width="900"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}"
        BorderBrush="{DynamicResource AccentBrush}"
        BorderThickness="1"
        GlowBrush="{DynamicResource AccentBrush}"
        ResizeMode="CanResizeWithGrip"
        TitleCharacterCasing="Normal">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource HeaderBrush}" Padding="20">
            <StackPanel>
                <TextBlock Text="ðŸ“– User Guide" FontSize="24" FontWeight="Bold"
                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                <TextBlock Text="Vessel Gyro Calibration Module - 7 Steps to Survey Excellence"
                           FontSize="14" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- Overview -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Overview" FontSize="18" FontWeight="SemiBold"
                                   Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            This module performs vessel gyro calibration or verification following Subsea7's GLSIFR0035 procedure.
                            It calculates the C-O (Calculated minus Observed) offset between a reference heading system 
                            (e.g., GNSS Compass) and the calibrated system (e.g., Vessel Gyro).
                        </TextBlock>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,10,0,0" LineHeight="24">
                            <Bold>Calibration Mode:</Bold> Determines the C-O correction value to apply to the gyro.
                            <LineBreak/>
                            <Bold>Verification Mode:</Bold> Validates that an existing C-O value is still accurate (result should be â‰ˆ0Â°).
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 1 -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Ellipse Width="28" Height="28" Fill="{DynamicResource AccentBrush}"/>
                            <TextBlock Text="1" FontSize="14" FontWeight="Bold" Foreground="White" 
                                       Margin="-19,5,0,0"/>
                            <TextBlock Text="Setup &amp; Configure" FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="10,3,0,0"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            <Bold>User Input:</Bold>
                            <LineBreak/>â€¢ Select Calibration or Verification mode
                            <LineBreak/>â€¢ Enter Project Title (required)
                            <LineBreak/>â€¢ Enter Vessel Name (required)
                            <LineBreak/>â€¢ Set Date, Surveyor name
                            <LineBreak/>â€¢ Specify Reference System (e.g., "GNSS Compass")
                            <LineBreak/>â€¢ Specify Calibrated System (e.g., "Sperry Gyro")
                            <LineBreak/>â€¢ Select Display Unit (Meters, International Feet, US Survey Feet, US Feet)
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 2 -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Ellipse Width="28" Height="28" Fill="{DynamicResource AccentBrush}"/>
                            <TextBlock Text="2" FontSize="14" FontWeight="Bold" Foreground="White" 
                                       Margin="-19,5,0,0"/>
                            <TextBlock Text="Import Data" FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="10,3,0,0"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            <Bold>User Input:</Bold>
                            <LineBreak/>â€¢ Browse and select NPD or CSV data file
                            <LineBreak/>â€¢ Use time filter to select data range (Start Time / End Time)
                            <LineBreak/>
                            <LineBreak/><Bold>Expected File Format:</Bold>
                            <LineBreak/>The file should contain columns for:
                            <LineBreak/>â€¢ Timestamp (Date/Time)
                            <LineBreak/>â€¢ Reference Heading (from GNSS Compass or similar)
                            <LineBreak/>â€¢ Calibrated Heading (from vessel gyro)
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 3 -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Ellipse Width="28" Height="28" Fill="{DynamicResource AccentBrush}"/>
                            <TextBlock Text="3" FontSize="14" FontWeight="Bold" Foreground="White" 
                                       Margin="-19,5,0,0"/>
                            <TextBlock Text="Configure Settings" FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="10,3,0,0"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            <Bold>User Input:</Bold>
                            <LineBreak/>â€¢ Set QC criteria thresholds:
                            <LineBreak/>  - Max Standard Deviation (default: 0.5Â°)
                            <LineBreak/>  - Max Range (default: 2.0Â°)
                            <LineBreak/>  - Min Points required (default: 100)
                            <LineBreak/>  - Sigma factor for outlier rejection (default: 3.0)
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 4 -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Ellipse Width="28" Height="28" Fill="{DynamicResource AccentBrush}"/>
                            <TextBlock Text="4" FontSize="14" FontWeight="Bold" Foreground="White" 
                                       Margin="-19,5,0,0"/>
                            <TextBlock Text="Process Data" FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="10,3,0,0"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            <Bold>Automatic Calculation:</Bold>
                            <LineBreak/>â€¢ Calculates C-O = Reference Heading - Calibrated Heading
                            <LineBreak/>â€¢ Applies 3-sigma outlier detection
                            <LineBreak/>â€¢ Computes Mean C-O and Standard Deviation
                            <LineBreak/>
                            <LineBreak/><Bold>Results Displayed:</Bold>
                            <LineBreak/>â€¢ Mean C-O value (degrees)
                            <LineBreak/>â€¢ Standard Deviation
                            <LineBreak/>â€¢ Accepted/Rejected point counts
                            <LineBreak/>â€¢ Data visualization chart
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 5 -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Ellipse Width="28" Height="28" Fill="{DynamicResource AccentBrush}"/>
                            <TextBlock Text="5" FontSize="14" FontWeight="Bold" Foreground="White" 
                                       Margin="-19,5,0,0"/>
                            <TextBlock Text="Analyze Results" FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="10,3,0,0"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            <Bold>Statistical Analysis:</Bold>
                            <LineBreak/>â€¢ Mean (All Points vs Accepted Points)
                            <LineBreak/>â€¢ Standard Deviation comparison
                            <LineBreak/>â€¢ Heading coverage analysis
                            <LineBreak/>â€¢ Time span of data
                            <LineBreak/>
                            <LineBreak/><Bold>Charts:</Bold>
                            <LineBreak/>â€¢ C-O distribution histogram
                            <LineBreak/>â€¢ Time series plot
                            <LineBreak/>â€¢ Heading vs C-O scatter plot
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 6 -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Ellipse Width="28" Height="28" Fill="{DynamicResource AccentBrush}"/>
                            <TextBlock Text="6" FontSize="14" FontWeight="Bold" Foreground="White" 
                                       Margin="-19,5,0,0"/>
                            <TextBlock Text="Validate &amp; QC" FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="10,3,0,0"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            <Bold>QC Checks Performed:</Bold>
                            <LineBreak/>â€¢ Standard Deviation within tolerance
                            <LineBreak/>â€¢ Minimum data points achieved
                            <LineBreak/>â€¢ Range within acceptable limits
                            <LineBreak/>â€¢ Heading coverage adequate
                            <LineBreak/>
                            <LineBreak/><Bold>User Decision:</Bold>
                            <LineBreak/>â€¢ Review all QC results (Pass/Warning/Fail)
                            <LineBreak/>â€¢ Accept or Reject the calibration result
                            <LineBreak/>â€¢ Add notes for documentation
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Step 7 -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Ellipse Width="28" Height="28" Fill="{DynamicResource AccentBrush}"/>
                            <TextBlock Text="7" FontSize="14" FontWeight="Bold" Foreground="White" 
                                       Margin="-19,5,0,0"/>
                            <TextBlock Text="Export Reports" FontSize="16" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}" Margin="10,3,0,0"/>
                        </StackPanel>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" LineHeight="24">
                            <Bold>Export Options:</Bold>
                            <LineBreak/>â€¢ PDF Report - Professional calibration certificate
                            <LineBreak/>â€¢ Excel Export - Full data and calculations
                            <LineBreak/>
                            <LineBreak/><Bold>Report Contents:</Bold>
                            <LineBreak/>â€¢ Project information header
                            <LineBreak/>â€¢ Calibration result summary
                            <LineBreak/>â€¢ Statistical analysis
                            <LineBreak/>â€¢ QC check results
                            <LineBreak/>â€¢ Data plots and charts
                            <LineBreak/>â€¢ Raw data listing
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Formula Reference -->
                <Border Style="{DynamicResource CardBorder}" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="ðŸ“ Formula Reference" FontSize="18" FontWeight="SemiBold"
                                   Foreground="{DynamicResource AccentBrush}" Margin="0,0,0,10"/>
                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" 
                                   FontFamily="Consolas" LineHeight="24">
                            C-O = Reference Heading - Calibrated Heading
                            <LineBreak/>
                            <LineBreak/>Mean C-O = Î£(C-O) / n
                            <LineBreak/>
                            <LineBreak/>Std Dev = âˆš(Î£(C-O - Mean)Â² / (n-1))
                            <LineBreak/>
                            <LineBreak/>Outlier if: |C-O - Mean| > (Sigma Ã— Std Dev)
                        </TextBlock>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" Padding="20,15">
            <Grid>
                <TextBlock Text="Fathom OS - Vessel Gyro Calibration Module" 
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           VerticalAlignment="Center"/>
                <Button Content="Close" HorizontalAlignment="Right" 
                        Style="{DynamicResource PrimaryButton}"
                        Click="CloseButton_Click" Width="100"/>
            </Grid>
        </Border>
    </Grid>
</mah:MetroWindow>
