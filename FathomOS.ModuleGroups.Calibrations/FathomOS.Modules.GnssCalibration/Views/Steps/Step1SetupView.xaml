<UserControl x:Class="FathomOS.Modules.GnssCalibration.Views.Steps.Step1SetupView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:converters="clr-namespace:FathomOS.Modules.GnssCalibration.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="650" d:DesignWidth="1000">

    <UserControl.Resources>
        <converters:NullToVisibilityConverter x:Key="NullToVisibility"/>
        <converters:NotNullToVisibilityConverter x:Key="NotNullToVisibility"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Step Header -->
            <StackPanel Grid.Row="0" Margin="0,0,0,15">
                <TextBlock Text="Project &amp; Files" Style="{DynamicResource SectionHeader}" FontSize="20"/>
                <TextBlock Text="Enter project information and select your survey data files." 
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
            </StackPanel>

            <!-- Row 1: Project Info + NPD File -->
            <Grid Grid.Row="1" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Project Information Card -->
                <Border Grid.Column="0" Style="{DynamicResource CardBorder}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <iconPacks:PackIconMaterial Kind="FolderInformation" Width="18" Height="18" 
                                                         Foreground="{DynamicResource AccentBrush}" 
                                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="Project Information" FontWeight="SemiBold" FontSize="14"
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Project Name -->
                            <StackPanel Grid.Row="0" Grid.Column="0">
                                <TextBlock Text="Project Name *" Style="{DynamicResource FieldLabel}" FontSize="11"/>
                                <TextBox Text="{Binding Project.ProjectName, UpdateSourceTrigger=PropertyChanged}" 
                                         mah:TextBoxHelper.Watermark="Project name" Height="28" Margin="0,0,0,8"/>
                            </StackPanel>

                            <!-- Vessel Name -->
                            <StackPanel Grid.Row="0" Grid.Column="2">
                                <TextBlock Text="Vessel Name *" Style="{DynamicResource FieldLabel}" FontSize="11"/>
                                <TextBox Text="{Binding Project.VesselName, UpdateSourceTrigger=PropertyChanged}" 
                                         mah:TextBoxHelper.Watermark="Vessel name" Height="28" Margin="0,0,0,8"/>
                            </StackPanel>

                            <!-- Survey Date -->
                            <StackPanel Grid.Row="1" Grid.Column="0">
                                <TextBlock Text="Survey Date" Style="{DynamicResource FieldLabel}" FontSize="11"/>
                                <DatePicker SelectedDate="{Binding Project.SurveyDate}" Height="28" Margin="0,0,0,8"/>
                            </StackPanel>

                            <!-- Location -->
                            <StackPanel Grid.Row="1" Grid.Column="2">
                                <TextBlock Text="Location" Style="{DynamicResource FieldLabel}" FontSize="11"/>
                                <TextBox Text="{Binding Project.Location, UpdateSourceTrigger=PropertyChanged}" 
                                         mah:TextBoxHelper.Watermark="Field / Site" Height="28" Margin="0,0,0,8"/>
                            </StackPanel>

                            <!-- Operator -->
                            <StackPanel Grid.Row="2" Grid.Column="0">
                                <TextBlock Text="Operator" Style="{DynamicResource FieldLabel}" FontSize="11"/>
                                <TextBox Text="{Binding Project.Operator, UpdateSourceTrigger=PropertyChanged}" 
                                         mah:TextBoxHelper.Watermark="Your name" Height="28"/>
                            </StackPanel>

                            <!-- Comparison Node -->
                            <StackPanel Grid.Row="2" Grid.Column="2">
                                <TextBlock Text="Comparison Node" Style="{DynamicResource FieldLabel}" FontSize="11"/>
                                <TextBox Text="{Binding Project.ComparisonNode, UpdateSourceTrigger=PropertyChanged}" 
                                         mah:TextBoxHelper.Watermark="Node reference" Height="28"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- NPD File Selection Card -->
                <Border Grid.Column="2" Style="{DynamicResource CardBorder}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <iconPacks:PackIconMaterial Kind="FileDocumentOutline" Width="18" Height="18" 
                                                         Foreground="{DynamicResource AccentBrush}" 
                                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="NPD Survey File" FontWeight="SemiBold" FontSize="14"
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <Border Background="{DynamicResource AccentBrush}" CornerRadius="3" 
                                    Padding="6,2" Margin="10,0,0,0">
                                <TextBlock Text="Required" FontSize="9" Foreground="White"/>
                            </Border>
                        </StackPanel>

                        <!-- File Drop Zone -->
                        <Border Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="2" CornerRadius="6" 
                                Height="120" AllowDrop="True">
                            <Grid>
                                <!-- Empty State -->
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                            Visibility="{Binding Project.NpdFilePath, Converter={StaticResource NullToVisibility}}">
                                    <iconPacks:PackIconMaterial Kind="FileUploadOutline" 
                                                                 Width="32" Height="32"
                                                                 Foreground="{DynamicResource TextSecondaryBrush}"
                                                                 HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                    <TextBlock Text="Drop NPD/CSV file here" FontSize="12"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                    <Button Content="Browse Files" Style="{DynamicResource SecondaryButton}"
                                            Click="BrowseNpdFile_Click" HorizontalAlignment="Center" Padding="15,5"/>
                                </StackPanel>

                                <!-- File Loaded State -->
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                            Visibility="{Binding Project.NpdFilePath, Converter={StaticResource NotNullToVisibility}}">
                                    <iconPacks:PackIconMaterial Kind="FileCheckOutline" 
                                                                 Width="32" Height="32"
                                                                 Foreground="{DynamicResource SuccessBrush}"
                                                                 HorizontalAlignment="Center" Margin="0,0,0,6"/>
                                    <TextBlock Text="{Binding LoadedFileName, Mode=OneWay}" FontSize="11" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"
                                               HorizontalAlignment="Center" MaxWidth="280" 
                                               TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{Binding LoadedFileInfo, Mode=OneWay}" FontSize="10"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               HorizontalAlignment="Center" Margin="0,2,0,6"/>
                                    <Button Content="Change File" Style="{DynamicResource SecondaryButton}"
                                            Click="BrowseNpdFile_Click" HorizontalAlignment="Center" 
                                            Padding="12,4" FontSize="10"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Row 2: POS File (Optional) + Settings Summary -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- POS File Selection Card -->
                <Border Grid.Column="0" Style="{DynamicResource CardBorder}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <iconPacks:PackIconMaterial Kind="Crosshairs" Width="18" Height="18" 
                                                         Foreground="{DynamicResource InfoBrush}" 
                                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="POS Reference File" FontWeight="SemiBold" FontSize="14"
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                            <Border Background="{DynamicResource TextSecondaryBrush}" CornerRadius="3" 
                                    Padding="6,2" Margin="10,0,0,0">
                                <TextBlock Text="Optional" FontSize="9" Foreground="White"/>
                            </Border>
                        </StackPanel>

                        <CheckBox Content="Use POS file as ground truth reference" 
                                  IsChecked="{Binding Project.UsePosAsReference, Mode=TwoWay}"
                                  Margin="0,0,0,10" FontSize="11"/>

                        <!-- POS File Drop Zone -->
                        <Border Background="{DynamicResource SurfaceBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1" CornerRadius="6" 
                                Height="80"
                                Visibility="{Binding Project.UsePosAsReference, Converter={StaticResource BoolToVisibility}}">
                            <Grid>
                                <!-- Empty State -->
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                            Visibility="{Binding Project.PosFilePath, Converter={StaticResource NullToVisibility}}">
                                    <TextBlock Text="Drop POS file or" FontSize="11"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               HorizontalAlignment="Center"/>
                                    <Button Content="Browse" Style="{DynamicResource SecondaryButton}"
                                            Click="BrowsePosFile_Click" HorizontalAlignment="Center" 
                                            Padding="12,3" Margin="0,5,0,0" FontSize="10"/>
                                </StackPanel>

                                <!-- File Loaded State -->
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                            Visibility="{Binding Project.PosFilePath, Converter={StaticResource NotNullToVisibility}}">
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="CheckCircle" Width="16" Height="16"
                                                                     Foreground="{DynamicResource SuccessBrush}"
                                                                     VerticalAlignment="Center" Margin="0,0,6,0"/>
                                        <TextBlock Text="{Binding PosLoadedFileName, Mode=OneWay}" FontSize="11"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   MaxWidth="200" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                    <Button Content="Change" Style="{DynamicResource SecondaryButton}"
                                            Click="BrowsePosFile_Click" HorizontalAlignment="Center" 
                                            Padding="10,2" Margin="0,5,0,0" FontSize="9"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- POS Settings (when file loaded) -->
                        <Grid Margin="0,10,0,0" 
                              Visibility="{Binding Project.PosFilePath, Converter={StaticResource NotNullToVisibility}}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Coordinate Type" Style="{DynamicResource FieldLabel}" FontSize="10"/>
                                <ComboBox SelectedIndex="{Binding PosCoordinateTypeIndex}" Height="26" FontSize="11">
                                    <ComboBoxItem Content="Geographic (Lat/Lon)"/>
                                    <ComboBoxItem Content="Projected (UTM)"/>
                                </ComboBox>
                            </StackPanel>
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="UTM Zone" Style="{DynamicResource FieldLabel}" FontSize="10"/>
                                <StackPanel Orientation="Horizontal">
                                    <mah:NumericUpDown Value="{Binding PosUtmZone}" 
                                                        Minimum="1" Maximum="60" 
                                                        Width="60" Height="26"/>
                                    <ComboBox SelectedIndex="{Binding PosHemisphereIndex}" 
                                              Width="45" Margin="5,0,0,0" Height="26">
                                        <ComboBoxItem Content="N"/>
                                        <ComboBoxItem Content="S"/>
                                    </ComboBox>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Quick Settings + Info Card -->
                <Border Grid.Column="2" Style="{DynamicResource CardBorder}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <iconPacks:PackIconMaterial Kind="Cog" Width="18" Height="18" 
                                                         Foreground="{DynamicResource AccentBrush}" 
                                                         VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBlock Text="Quick Settings" FontWeight="SemiBold" FontSize="14"
                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                        </StackPanel>

                        <!-- Coordinate Unit -->
                        <TextBlock Text="Coordinate Unit *" Style="{DynamicResource FieldLabel}" FontSize="11"/>
                        <ComboBox SelectedIndex="{Binding Project.UnitIndex}" Height="28" Margin="0,0,0,12">
                            <ComboBoxItem Content="Meters (m)"/>
                            <ComboBoxItem Content="International Feet (ft)"/>
                            <ComboBoxItem Content="US Survey Feet (US ft)"/>
                        </ComboBox>

                        <!-- Info Box -->
                        <Border Background="{DynamicResource SurfaceBrush}" 
                                CornerRadius="6" Padding="12" Margin="0,5,0,0">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                    <iconPacks:PackIconMaterial Kind="InformationOutline" 
                                                                 Width="16" Height="16"
                                                                 Foreground="{DynamicResource InfoBrush}"
                                                                 VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <TextBlock Text="What's Next?" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                </StackPanel>
                                <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}">
                                    After loading your NPD file, you'll map columns to GNSS systems and preview the data with time filtering options.
                                </TextBlock>
                                <TextBlock Text="* Required fields" FontSize="10" 
                                           Foreground="{DynamicResource TextSecondaryBrush}" 
                                           Margin="0,10,0,0" FontStyle="Italic"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>
