<UserControl x:Class="FathomOS.Modules.RovGyroCalibration.Views.Steps.Step7ExportView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:converters="clr-namespace:FathomOS.Modules.RovGyroCalibration.Converters">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="Step 7: Export Results" 
                       FontSize="24" FontWeight="SemiBold"
                       Foreground="{DynamicResource TextPrimaryBrush}"/>
            <TextBlock Text="Generate calibration reports and export data"
                       FontSize="14" Foreground="{DynamicResource TextSecondaryBrush}"
                       Margin="0,5,0,0"/>
        </StackPanel>
        
        <!-- Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Export Options -->
            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <!-- Export Format Selection -->
                <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Export Formats" FontWeight="SemiBold" FontSize="16"
                                   Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,15"/>
                        
                        <!-- PDF Option -->
                        <CheckBox IsChecked="{Binding ExportPdf}" Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <Border Background="#E53935" CornerRadius="4" Padding="8" Margin="0,0,12,0">
                                    <iconPacks:PackIconMaterial Kind="FilePdfBox" Width="20" Height="20" Foreground="White"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="PDF Report" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <TextBlock Text="Complete ROV calibration report with geometric details" FontSize="11"
                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </CheckBox>
                        
                        <!-- Excel Option -->
                        <CheckBox IsChecked="{Binding ExportExcel}" Margin="0,0,0,12">
                            <StackPanel Orientation="Horizontal">
                                <Border Background="#217346" CornerRadius="4" Padding="8" Margin="0,0,12,0">
                                    <iconPacks:PackIconMaterial Kind="MicrosoftExcel" Width="20" Height="20" Foreground="White"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Excel Workbook" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <TextBlock Text="Complete data with geometric corrections" FontSize="11"
                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </CheckBox>
                        
                        <!-- CSV Option -->
                        <CheckBox IsChecked="{Binding ExportCsv}" Margin="0,0,0,0">
                            <StackPanel Orientation="Horizontal">
                                <Border Background="#607D8B" CornerRadius="4" Padding="8" Margin="0,0,12,0">
                                    <iconPacks:PackIconMaterial Kind="FileDelimited" Width="20" Height="20" Foreground="White"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="CSV Data" FontWeight="SemiBold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <TextBlock Text="Raw data for external processing" FontSize="11"
                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </CheckBox>
                    </StackPanel>
                </Border>
                
                <!-- Output Directory -->
                <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <TextBlock Text="Output Directory" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,10"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBox Grid.Column="0" Text="{Binding OutputDirectory, Mode=TwoWay}"
                                     IsReadOnly="True" Background="{DynamicResource SurfaceBrush}"
                                     Foreground="{DynamicResource TextPrimaryBrush}"
                                     BorderBrush="{DynamicResource BorderBrush}"
                                     Padding="10,8"/>
                            
                            <Button Grid.Column="1" Content="Browse" Command="{Binding BrowseOutputCommand}"
                                    Style="{DynamicResource SecondaryButton}" Margin="10,0,0,0"
                                    Padding="15,8"/>
                        </Grid>
                    </StackPanel>
                </Border>
                
                <!-- Export Button -->
                <Button Command="{Binding ExportCommand}" 
                        Style="{DynamicResource PrimaryButton}" 
                        HorizontalAlignment="Stretch" Padding="20,15">
                    <StackPanel Orientation="Horizontal">
                        <iconPacks:PackIconMaterial Kind="Export" Width="20" Height="20" 
                                                    Foreground="White" Margin="0,0,10,0"
                                                    VerticalAlignment="Center"/>
                        <TextBlock Text="Export Selected Formats" FontSize="14" FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                
                <!-- Export Status -->
                <TextBlock Text="{Binding StatusMessage}" 
                           Foreground="{DynamicResource AccentBrush}"
                           HorizontalAlignment="Center" Margin="0,10,0,0"
                           FontWeight="SemiBold"/>
            </StackPanel>
            
            <!-- Export Status & Summary -->
            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                <!-- Summary Card -->
                <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <iconPacks:PackIconMaterial Kind="CheckCircle" Width="24" Height="24"
                                                        Foreground="{DynamicResource SuccessBrush}"/>
                            <TextBlock Text="ROV Calibration Complete" FontWeight="SemiBold" FontSize="16"
                                       Foreground="{DynamicResource TextPrimaryBrush}"
                                       VerticalAlignment="Center" Margin="10,0,0,0"/>
                        </StackPanel>
                        
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Decision" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Grid.Column="1" Text="{Binding Decision}" FontWeight="Bold" FontSize="14"
                                       Foreground="{DynamicResource SuccessBrush}"/>
                        </Grid>
                        
                        <Grid Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Mean C-O" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Grid.Column="1" Text="{Binding MeanCO, StringFormat={}{0:F4}°}" 
                                       FontWeight="SemiBold" Foreground="{DynamicResource AccentBrush}"/>
                        </Grid>
                        
                        <Grid Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Baseline Angle θ" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Grid.Column="1" Text="{Binding BaselineAngle, StringFormat={}{0:F4}°}" 
                                       FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        </Grid>
                        
                        <Grid Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Std Deviation" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Grid.Column="1" Text="{Binding StdDev, StringFormat={}{0:F4}°}" 
                                       FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                        </Grid>
                        
                        <Grid Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Observations" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Grid.Column="1" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextPrimaryBrush}">
                                <Run Text="{Binding AcceptedCount, Mode=OneWay}"/>
                                <Run Text=" / "/>
                                <Run Text="{Binding TotalCount, Mode=OneWay}"/>
                            </TextBlock>
                        </Grid>
                    </StackPanel>
                </Border>
                
                <!-- Progress Indicator -->
                <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15"
                        Visibility="{Binding IsExporting, Converter={StaticResource BoolToVisibility}}">
                    <StackPanel>
                        <TextBlock Text="Exporting..." FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,10"/>
                        <mah:MetroProgressBar IsIndeterminate="True" Height="4"/>
                    </StackPanel>
                </Border>
                
                <!-- Open Output Folder -->
                <Button Content="  Open Output Folder  " Command="{Binding OpenOutputFolderCommand}"
                        Style="{DynamicResource SecondaryButton}" HorizontalAlignment="Stretch"
                        Padding="15,12"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
