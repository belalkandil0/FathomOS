<mah:MetroWindow x:Class="FathomOS.Modules.SurveyListing.Views.CadExportDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        Title="Export CAD Script" Height="550" Width="450"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        TitleCharacterCasing="Normal"
        GlowBrush="{DynamicResource MahApps.Brushes.Accent}"
        BorderThickness="1"
        ShowMinButton="False"
        ShowMaxRestoreButton="False">
    
    <mah:MetroWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Controls.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Fonts.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MahApps.Metro;component/Styles/Themes/Dark.Blue.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </mah:MetroWindow.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="Select Layers to Export" FontSize="16" FontWeight="SemiBold"/>
            <TextBlock Text="Choose which layers to include in the CAD script file." 
                       Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,5,0,0"/>
        </StackPanel>
        
        <!-- Layer List -->
        <Border Grid.Row="1" BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="1" CornerRadius="4">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="LayerListControl" Margin="5">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="8,6" Margin="2" CornerRadius="3"
                                    Background="{DynamicResource PanelBackgroundBrush}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Checkbox -->
                                    <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" 
                                              VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    
                                    <!-- Color Indicator -->
                                    <Border Grid.Column="1" Width="16" Height="16" CornerRadius="2"
                                            Background="{Binding ColorBrush}" Margin="0,0,8,0"
                                            VerticalAlignment="Center"/>
                                    
                                    <!-- Layer Name -->
                                    <TextBlock Grid.Column="2" Text="{Binding Name}" 
                                               VerticalAlignment="Center"/>
                                    
                                    <!-- Point Count -->
                                    <TextBlock Grid.Column="3" Text="{Binding PointCount, StringFormat='({0} pts)'}" 
                                               Foreground="{DynamicResource SecondaryTextBrush}"
                                               VerticalAlignment="Center" Margin="10,0,0,0"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
        
        <!-- Options -->
        <GroupBox Grid.Row="2" Header="Options" Margin="0,15,0,0" Padding="10">
            <StackPanel>
                <CheckBox x:Name="ChkIncludePoints" Content="Include point markers" 
                          IsChecked="True" Margin="0,0,0,8"/>
                <CheckBox x:Name="ChkIncludePolylines" Content="Include polylines (connected track)" 
                          IsChecked="True" Margin="0,0,0,8"/>
                <CheckBox x:Name="ChkIncludeLayerSetup" Content="Include layer setup commands" 
                          IsChecked="True" Margin="0,0,0,8"/>
                <CheckBox x:Name="ChkExcludeDeleted" Content="Exclude deleted points" 
                          IsChecked="True" Margin="0,0,0,8"
                          ToolTip="Skip points marked for deletion"/>
                <CheckBox x:Name="ChkIncludeAdded" Content="Include added/digitized points" 
                          IsChecked="True" Margin="0,0,0,8"
                          ToolTip="Include newly digitized points"/>
                
                <Grid Margin="0,5,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <CheckBox x:Name="ChkUseExaggeration" Content="Apply depth exaggeration:" 
                              VerticalAlignment="Center"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0">
                        <TextBox x:Name="TxtExaggeration" Text="10" Width="50" 
                                 IsEnabled="{Binding IsChecked, ElementName=ChkUseExaggeration}"/>
                        <TextBlock Text="x" VerticalAlignment="Center" Margin="5,0,0,0"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </GroupBox>
        
        <!-- Format -->
        <GroupBox Grid.Row="3" Header="Output Format" Margin="0,15,0,0" Padding="10">
            <StackPanel Orientation="Horizontal">
                <RadioButton x:Name="RdoAutoCAD" Content="AutoCAD Script (.scr)" 
                             IsChecked="True" Margin="0,0,20,0"/>
                <RadioButton x:Name="RdoBricsCAD" Content="BricsCAD Script (.scr)"/>
                <TextBlock Text="(Same format)" Foreground="{DynamicResource SecondaryTextBrush}" 
                           VerticalAlignment="Center" Margin="10,0,0,0" FontStyle="Italic"/>
            </StackPanel>
        </GroupBox>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Select All" Padding="15,8" Margin="0,0,10,0" Click="SelectAll_Click"/>
            <Button Content="Select None" Padding="15,8" Margin="0,0,20,0" Click="SelectNone_Click"/>
            <Button Content="Export..." Padding="20,8" Margin="0,0,10,0" 
                    Background="{DynamicResource AccentBrush}" Foreground="White"
                    Click="Export_Click"/>
            <Button Content="Cancel" Padding="20,8" IsCancel="True" Click="Cancel_Click"/>
        </StackPanel>
    </Grid>
</mah:MetroWindow>
