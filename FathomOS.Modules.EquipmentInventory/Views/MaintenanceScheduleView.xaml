<mah:MetroWindow x:Class="FathomOS.Modules.EquipmentInventory.Views.MaintenanceScheduleView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:converters="clr-namespace:FathomOS.Modules.EquipmentInventory.Converters"
        Title="Maintenance Schedule - Fathom OS"
        Height="700" Width="1000"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}">
    
    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:StringToSolidColorBrushConverter x:Key="StringToBrush"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource HeaderBrush}" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconMaterial Kind="CalendarClock" Width="28" Height="28" 
                                                 VerticalAlignment="Center" Margin="0,0,12,0"
                                                 Foreground="{DynamicResource AccentBrush}"/>
                    <TextBlock Text="Maintenance Schedule" FontSize="22" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                </StackPanel>
                
                <Button Grid.Column="1" Command="{Binding RefreshCommand}" Style="{DynamicResource SecondaryButton}">
                    <StackPanel Orientation="Horizontal">
                        <iconPacks:PackIconMaterial Kind="Refresh" Width="16" Height="16" Margin="0,0,6,0"/>
                        <TextBlock Text="Refresh"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
        
        <!-- Summary Cards -->
        <UniformGrid Grid.Row="1" Columns="4" Margin="20,15">
            <Border Style="{DynamicResource CardBorder}" Margin="0,0,8,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Overdue" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                    <TextBlock Text="{Binding Summary.TotalOverdue}" FontSize="28" FontWeight="Bold"
                               Foreground="{DynamicResource ErrorBrush}"/>
                </StackPanel>
            </Border>
            <Border Style="{DynamicResource CardBorder}" Margin="4,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Due This Week" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                    <TextBlock Text="{Binding Summary.UpcomingThisWeek}" FontSize="28" FontWeight="Bold"
                               Foreground="{DynamicResource WarningBrush}"/>
                </StackPanel>
            </Border>
            <Border Style="{DynamicResource CardBorder}" Margin="4,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Due This Month" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                    <TextBlock Text="{Binding Summary.UpcomingThisMonth}" FontSize="28" FontWeight="Bold"
                               Foreground="{DynamicResource AccentBrush}"/>
                </StackPanel>
            </Border>
            <Border Style="{DynamicResource CardBorder}" Margin="8,0,0,0" Padding="15">
                <StackPanel>
                    <TextBlock Text="Total Upcoming" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                    <TextBlock Text="{Binding Summary.TotalUpcoming}" FontSize="28" FontWeight="Bold"
                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                </StackPanel>
            </Border>
        </UniformGrid>
        
        <!-- Filter Tabs and List -->
        <Grid Grid.Row="2" Margin="20,0,20,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            <!-- Filter Tabs -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                <RadioButton Content="All" IsChecked="{Binding FilterAll}" Style="{DynamicResource FilterButton}" Margin="0,0,8,0"/>
                <RadioButton Content="Certifications" IsChecked="{Binding FilterCertifications}" Style="{DynamicResource FilterButton}" Margin="0,0,8,0"/>
                <RadioButton Content="Calibrations" IsChecked="{Binding FilterCalibrations}" Style="{DynamicResource FilterButton}" Margin="0,0,8,0"/>
                <RadioButton Content="Services" IsChecked="{Binding FilterServices}" Style="{DynamicResource FilterButton}" Margin="0,0,8,0"/>
                <RadioButton Content="Inspections" IsChecked="{Binding FilterInspections}" Style="{DynamicResource FilterButton}"/>
                
                <CheckBox Content="Show Overdue Only" IsChecked="{Binding ShowOverdueOnly}" 
                          Margin="30,0,0,0" VerticalAlignment="Center"/>
            </StackPanel>
            
            <!-- Maintenance Items List -->
            <DataGrid Grid.Row="1" ItemsSource="{Binding MaintenanceItems}" 
                      AutoGenerateColumns="False" IsReadOnly="True"
                      Background="{DynamicResource CardBrush}"
                      RowBackground="{DynamicResource CardBrush}"
                      AlternatingRowBackground="{DynamicResource SurfaceBrush}"
                      GridLinesVisibility="Horizontal"
                      BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}">
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Status" Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="3" Padding="6,3" HorizontalAlignment="Center"
                                        Background="{Binding StatusColor, Converter={StaticResource StringToBrush}}">
                                    <TextBlock Text="{Binding MaintenanceType}" Foreground="White" FontSize="10"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Asset #" Binding="{Binding AssetNumber}" Width="100"/>
                    <DataGridTextColumn Header="Equipment" Binding="{Binding EquipmentName}" Width="*"/>
                    <DataGridTextColumn Header="Category" Binding="{Binding CategoryName}" Width="120"/>
                    <DataGridTextColumn Header="Location" Binding="{Binding LocationName}" Width="120"/>
                    <DataGridTextColumn Header="Due Date" Binding="{Binding DueDate, StringFormat=d}" Width="100"/>
                    <DataGridTemplateColumn Header="Due In" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding StatusText}" 
                                           Foreground="{Binding StatusColor, Converter={StaticResource StringToBrush}}" FontWeight="SemiBold"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="Actions" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="Complete" Style="{DynamicResource SecondaryButton}"
                                            Command="{Binding DataContext.CompleteMaintenanceCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}" Padding="8,3" FontSize="11" Margin="0,0,5,0"/>
                                    <Button Style="{DynamicResource SecondaryButton}" Padding="5,3"
                                            Command="{Binding DataContext.ViewEquipmentCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                            CommandParameter="{Binding}" ToolTip="View Equipment">
                                        <iconPacks:PackIconMaterial Kind="Eye" Width="12" Height="12"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</mah:MetroWindow>
