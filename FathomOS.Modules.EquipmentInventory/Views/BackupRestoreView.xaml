<mah:MetroWindow x:Class="FathomOS.Modules.EquipmentInventory.Views.BackupRestoreView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:converters="clr-namespace:FathomOS.Modules.EquipmentInventory.Converters"
        Title="Backup &amp; Restore - Fathom OS"
        Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource BackgroundBrush}">
    
    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource HeaderBrush}" Padding="20,15">
            <StackPanel Orientation="Horizontal">
                <iconPacks:PackIconMaterial Kind="BackupRestore" Width="28" Height="28" 
                                             VerticalAlignment="Center" Margin="0,0,12,0"
                                             Foreground="{DynamicResource AccentBrush}"/>
                <TextBlock Text="Backup &amp; Restore" FontSize="22" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
        
        <!-- Content -->
        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Create Backup Panel -->
            <Border Grid.Column="0" Style="{DynamicResource CardBorder}" Margin="0,0,10,0">
                <StackPanel Margin="20">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <iconPacks:PackIconMaterial Kind="CloudUpload" Width="24" Height="24" 
                                                     Foreground="{DynamicResource AccentBrush}" Margin="0,0,10,0"/>
                        <TextBlock Text="Create Backup" FontSize="18" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                    </StackPanel>
                    
                    <TextBlock Text="Create a backup of your equipment database, photos, and documents."
                               Foreground="{DynamicResource TextSecondaryBrush}" TextWrapping="Wrap" Margin="0,0,0,20"/>
                    
                    <CheckBox Content="Include Photos" IsChecked="{Binding IncludePhotos}" Margin="0,0,0,10"/>
                    <CheckBox Content="Include Documents" IsChecked="{Binding IncludeDocuments}" Margin="0,0,0,10"/>
                    <CheckBox Content="Include Settings" IsChecked="{Binding IncludeSettings}" Margin="0,0,0,20"/>
                    
                    <Button Command="{Binding CreateBackupCommand}" Style="{DynamicResource PrimaryButton}"
                            HorizontalAlignment="Stretch" Height="40">
                        <StackPanel Orientation="Horizontal">
                            <iconPacks:PackIconMaterial Kind="ContentSave" Width="18" Height="18" Margin="0,0,8,0"/>
                            <TextBlock Text="Create Backup Now"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Auto Backup Settings -->
                    <Separator Margin="0,25"/>
                    <TextBlock Text="Auto Backup" FontWeight="SemiBold" Margin="0,0,0,10"
                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                    
                    <CheckBox Content="Enable Auto Backup" IsChecked="{Binding AutoBackupEnabled}" Margin="0,0,0,10"/>
                    
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Frequency:" VerticalAlignment="Center" Margin="0,0,10,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <ComboBox Grid.Column="1" SelectedItem="{Binding BackupFrequency}"
                                  ItemsSource="{Binding FrequencyOptions}"/>
                    </Grid>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Keep backups:" VerticalAlignment="Center" Margin="0,0,10,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <mah:NumericUpDown Grid.Column="1" Value="{Binding KeepBackupCount}" 
                                           Minimum="1" Maximum="50"/>
                    </Grid>
                    
                    <TextBlock Text="{Binding LastBackupText}" Foreground="{DynamicResource TextSecondaryBrush}"
                               FontSize="11" Margin="0,15,0,0"/>
                </StackPanel>
            </Border>
            
            <!-- Available Backups Panel -->
            <Border Grid.Column="1" Style="{DynamicResource CardBorder}" Margin="10,0,0,0">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <iconPacks:PackIconMaterial Kind="History" Width="24" Height="24" 
                                                     Foreground="{DynamicResource AccentBrush}" Margin="0,0,10,0"/>
                        <TextBlock Text="Available Backups" FontSize="18" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"/>
                    </StackPanel>
                    
                    <ListBox Grid.Row="1" ItemsSource="{Binding AvailableBackups}" 
                             SelectedItem="{Binding SelectedBackup}"
                             Background="Transparent" BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="10" BorderBrush="{DynamicResource BorderBrush}" 
                                        BorderThickness="0,0,0,1" Margin="0,0,0,5">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="{Binding BackupDate, StringFormat='MMM dd, yyyy HH:mm'}"
                                                       FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                            <TextBlock Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11">
                                                <Run Text="{Binding FileSizeDisplay}"/> â€¢ <Run Text="{Binding MachineName}"/>
                                            </TextBlock>
                                        </StackPanel>
                                        <Button Grid.Column="1" Style="{DynamicResource SecondaryButton}" Padding="8,4"
                                                Command="{Binding DataContext.DeleteBackupCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                CommandParameter="{Binding}" ToolTip="Delete">
                                            <iconPacks:PackIconMaterial Kind="Delete" Width="14" Height="14"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <StackPanel Grid.Row="2" Margin="0,15,0,0">
                        <Button Command="{Binding RestoreBackupCommand}" Style="{DynamicResource PrimaryButton}"
                                IsEnabled="{Binding CanRestore}" HorizontalAlignment="Stretch" Height="40">
                            <StackPanel Orientation="Horizontal">
                                <iconPacks:PackIconMaterial Kind="Restore" Width="18" Height="18" Margin="0,0,8,0"/>
                                <TextBlock Text="Restore Selected Backup"/>
                            </StackPanel>
                        </Button>
                        <TextBlock Text="Warning: Restoring will replace current data!" 
                                   Foreground="{DynamicResource WarningBrush}" FontSize="11" 
                                   HorizontalAlignment="Center" Margin="0,8,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Loading Overlay -->
        <Border Grid.RowSpan="2" Background="#80000000" 
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibility}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <mah:ProgressRing IsActive="True" Width="60" Height="60"/>
                <TextBlock Text="{Binding BusyMessage}" Foreground="White" Margin="0,15,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</mah:MetroWindow>
