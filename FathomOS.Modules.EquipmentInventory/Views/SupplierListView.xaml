<UserControl x:Class="FathomOS.Modules.EquipmentInventory.Views.SupplierListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:converters="clr-namespace:FathomOS.Modules.EquipmentInventory.Converters">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibility"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel>
                <TextBlock Text="Suppliers" Style="{DynamicResource HeadingLarge}" Margin="0,0,0,5"/>
                <TextBlock Text="Manage equipment suppliers and rental companies" 
                           Foreground="{DynamicResource TextSecondaryBrush}" FontSize="14"/>
            </StackPanel>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Button Style="{DynamicResource SecondaryButton}" Margin="0,0,10,0"
                        Command="{Binding RefreshCommand}" ToolTip="Refresh">
                    <iconPacks:PackIconMaterial Kind="Refresh" Width="16" Height="16"/>
                </Button>
                <Button Style="{DynamicResource PrimaryButton}" Command="{Binding AddSupplierCommand}">
                    <StackPanel Orientation="Horizontal">
                        <iconPacks:PackIconMaterial Kind="Plus" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="Add Supplier"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
        
        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="350"/>
                <ColumnDefinition Width="380"/>
            </Grid.ColumnDefinitions>
            
            <!-- Supplier List -->
            <Border Grid.Column="0" Style="{DynamicResource CardBorder}" Margin="0,0,15,0" Padding="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Search Bar -->
                    <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="15" 
                            CornerRadius="12,12,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="12,8">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <iconPacks:PackIconMaterial Kind="Magnify" Width="16" Height="16" 
                                                                 VerticalAlignment="Center" Margin="0,0,10,0"
                                                                 Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                             BorderThickness="0" Background="Transparent" 
                                             VerticalAlignment="Center"
                                             mah:TextBoxHelper.Watermark="Search suppliers..."/>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>
                    
                    <!-- List -->
                    <ListBox Grid.Row="1" ItemsSource="{Binding FilteredSuppliers}" 
                             SelectedItem="{Binding SelectedSupplier}"
                             BorderThickness="0" Background="Transparent"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="15,12" BorderThickness="0,0,0,1" 
                                        BorderBrush="{DynamicResource BorderBrush}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Icon -->
                                        <Border Width="40" Height="40" CornerRadius="8" 
                                                Background="{DynamicResource AccentBrush}" Opacity="0.2"
                                                Margin="0,0,12,0">
                                            <iconPacks:PackIconMaterial Kind="TruckDelivery" Width="20" Height="20"
                                                                         HorizontalAlignment="Center" VerticalAlignment="Center"
                                                                         Foreground="{DynamicResource AccentBrush}"/>
                                        </Border>
                                        
                                        <!-- Info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Name}" FontWeight="SemiBold" FontSize="14"
                                                       Foreground="{DynamicResource TextPrimaryBrush}"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,3,0,0">
                                                <TextBlock Text="{Binding Code}" FontFamily="Consolas" FontSize="11"
                                                           Foreground="{DynamicResource AccentBrush}" 
                                                           Visibility="{Binding Code, Converter={StaticResource NullToVisibility}}"/>
                                                <TextBlock Text=" â€¢ " Foreground="{DynamicResource TextSecondaryBrush}"
                                                           Visibility="{Binding ContactPerson, Converter={StaticResource NullToVisibility}}"/>
                                                <TextBlock Text="{Binding ContactPerson}" FontSize="12"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Active indicator -->
                                        <Border Grid.Column="2" Width="8" Height="8" CornerRadius="4"
                                                Background="{DynamicResource SuccessBrush}"
                                                Visibility="{Binding IsActive, Converter={StaticResource BoolToVisibility}}"
                                                VerticalAlignment="Center" ToolTip="Active"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </Border>
            
            <!-- Details Panel -->
            <Border Grid.Column="1" Style="{DynamicResource CardBorder}" Padding="20">
                <Grid>
                    <!-- Empty State -->
                    <StackPanel Visibility="{Binding SelectedSupplier, Converter={StaticResource NullToVisibility}, ConverterParameter=Inverse}"
                                VerticalAlignment="Center" HorizontalAlignment="Center">
                        <iconPacks:PackIconMaterial Kind="TruckDeliveryOutline" Width="48" Height="48" 
                                                     Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.5"
                                                     HorizontalAlignment="Center"/>
                        <TextBlock Text="Select a Supplier" FontSize="16" Margin="0,15,0,5"
                                   Foreground="{DynamicResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                        <TextBlock Text="Click on a supplier to view details" FontSize="12"
                                   Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Supplier Details -->
                    <Grid Visibility="{Binding SelectedSupplier, Converter={StaticResource NullToVisibility}}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                    
                    <!-- Header -->
                    <StackPanel Grid.Row="0" Margin="0,0,0,20">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <Border Width="56" Height="56" CornerRadius="12" Margin="0,0,15,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#4CAF50" Offset="0"/>
                                        <GradientStop Color="#2E7D32" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <iconPacks:PackIconMaterial Kind="TruckDelivery" Width="28" Height="28"
                                                             HorizontalAlignment="Center" VerticalAlignment="Center"
                                                             Foreground="White"/>
                            </Border>
                            
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{Binding SelectedSupplier.Name}" FontSize="18" FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextPrimaryBrush}" TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding SelectedSupplier.Code}" FontFamily="Consolas" FontSize="12"
                                           Foreground="{DynamicResource AccentBrush}" Margin="0,3,0,0"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                    
                    <!-- Details -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <TextBlock Text="CONTACT INFORMATION" FontSize="11" FontWeight="SemiBold" 
                                       Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,12"/>
                            
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <iconPacks:PackIconMaterial Kind="Account" Width="16" Height="16" Margin="0,0,10,0"
                                                             Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedSupplier.ContactPerson, TargetNullValue='Not specified'}"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                            </Grid>
                            
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <iconPacks:PackIconMaterial Kind="Email" Width="16" Height="16" Margin="0,0,10,0"
                                                             Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedSupplier.Email, TargetNullValue='Not specified'}"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                            </Grid>
                            
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <iconPacks:PackIconMaterial Kind="Phone" Width="16" Height="16" Margin="0,0,10,0"
                                                             Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedSupplier.Phone, TargetNullValue='Not specified'}"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                            </Grid>
                            
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <iconPacks:PackIconMaterial Kind="MapMarker" Width="16" Height="16" Margin="0,0,10,0"
                                                             Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Top"/>
                                <TextBlock Grid.Column="1" Text="{Binding SelectedSupplier.Address, TargetNullValue='Not specified'}"
                                           Foreground="{DynamicResource TextPrimaryBrush}" TextWrapping="Wrap"/>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                    
                    <!-- Action Buttons -->
                    <UniformGrid Grid.Row="2" Columns="2" Margin="0,15,0,0">
                        <Button Content="Edit" Style="{DynamicResource SecondaryButton}" Margin="0,0,5,0"
                                Command="{Binding EditSupplierCommand}">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="Pencil" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <TextBlock Text="Edit"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                        <Button Content="Delete" Style="{DynamicResource DangerButton}" Margin="5,0,0,0"
                                Command="{Binding DeleteSupplierCommand}">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="Delete" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                        <TextBlock Text="Delete"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                    </UniformGrid>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
