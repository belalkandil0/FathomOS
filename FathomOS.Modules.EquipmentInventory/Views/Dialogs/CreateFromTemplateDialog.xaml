<mah:MetroWindow x:Class="FathomOS.Modules.EquipmentInventory.Views.Dialogs.CreateFromTemplateDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        Title="Create from Template"
        Height="550" Width="500"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        TitleCharacterCasing="Normal"
        BorderThickness="1"
        BorderBrush="{DynamicResource AccentBrush}"
        GlowBrush="{DynamicResource AccentBrush}">
    
    <Grid Margin="25">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <iconPacks:PackIconMaterial Kind="FileDocumentOutline" Width="28" Height="28" 
                                            Foreground="{DynamicResource AccentBrush}" 
                                            VerticalAlignment="Center" Margin="0,0,12,0"/>
                <TextBlock Text="Create from Template" Style="{DynamicResource HeadingMedium}"/>
            </StackPanel>
            <TextBlock Text="Select a template to create new equipment." 
                       Foreground="{DynamicResource TextSecondaryBrush}" FontSize="13"/>
        </StackPanel>
        
        <!-- Search -->
        <TextBox Grid.Row="1" x:Name="SearchBox" Margin="0,0,0,15"
                 mah:TextBoxHelper.Watermark="Search templates..."
                 mah:TextBoxHelper.ClearTextButton="True"
                 TextChanged="SearchBox_TextChanged"/>
        
        <!-- Template List -->
        <ListBox Grid.Row="2" x:Name="TemplatesList"
                 Background="Transparent" BorderThickness="0"
                 SelectionChanged="TemplatesList_SelectionChanged">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Background="{DynamicResource CardBrush}" CornerRadius="8" 
                            Padding="15" Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <iconPacks:PackIconMaterial Kind="FileDocumentOutline"
                                                        Width="24" Height="24" Margin="0,0,15,0"
                                                        Foreground="{DynamicResource AccentBrush}"
                                                        VerticalAlignment="Center"/>
                            
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="{Binding TemplateName}" FontWeight="SemiBold" FontSize="14"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <TextBlock Text="{Binding Description}" FontSize="12"
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           TextTrimming="CharacterEllipsis" MaxWidth="280"/>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="{Binding Category.Name, FallbackValue='General'}" 
                                               FontSize="11" Foreground="{DynamicResource AccentBrush}"/>
                                    <TextBlock Text=" â€¢ " Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    <TextBlock Text="{Binding CreatedAt, StringFormat='Created {0:MMM dd, yyyy}'}" 
                                               FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </StackPanel>
                            
                            <TextBlock Grid.Column="2" Text="{Binding UsageCount, StringFormat='Used {0}x'}"
                                       FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"
                                       VerticalAlignment="Center"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        
        <!-- Empty State -->
        <StackPanel x:Name="EmptyState" Grid.Row="2" VerticalAlignment="Center" 
                    HorizontalAlignment="Center" Visibility="Collapsed">
            <iconPacks:PackIconMaterial Kind="FileDocumentRemoveOutline" Width="48" Height="48" 
                                        Foreground="{DynamicResource TextSecondaryBrush}" 
                                        HorizontalAlignment="Center" Opacity="0.5"/>
            <TextBlock Text="No templates found" FontSize="14" FontWeight="SemiBold"
                       Foreground="{DynamicResource TextSecondaryBrush}" 
                       HorizontalAlignment="Center" Margin="0,15,0,5"/>
            <TextBlock Text="Save equipment as a template first"
                       Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"
                       HorizontalAlignment="Center" Opacity="0.7"/>
        </StackPanel>
        
        <!-- Customization -->
        <Border Grid.Row="3" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" 
                Padding="15" Margin="0,15,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,0">
                    <TextBlock Text="Custom Name (optional)" FontSize="11" 
                               Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                    <TextBox x:Name="CustomNameBox" 
                             mah:TextBoxHelper.Watermark="Use template name"/>
                </StackPanel>
                
                <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,0,0">
                    <TextBlock Text="Location" FontSize="11" 
                               Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                    <ComboBox x:Name="LocationCombo" DisplayMemberPath="Name"/>
                </StackPanel>
                
                <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="0,10,0,0">
                    <TextBlock Text="Number to Create" FontSize="11" 
                               Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                    <mah:NumericUpDown x:Name="CountBox" Value="1" Minimum="1" Maximum="50" Width="120"
                                       HorizontalAlignment="Left"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Buttons -->
        <Grid Grid.Row="4" Margin="0,20,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <Button Grid.Column="1" Content="Cancel" Style="{DynamicResource SecondaryButton}"
                    Click="Cancel_Click" Padding="20,10" Margin="0,0,10,0"/>
            <Button Grid.Column="2" x:Name="CreateButton" Style="{DynamicResource PrimaryButton}"
                    Click="Create_Click" Padding="20,10" IsEnabled="False">
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconMaterial Kind="Plus" Width="16" Height="16" 
                                                VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="Create Equipment"/>
                </StackPanel>
            </Button>
        </Grid>
    </Grid>
</mah:MetroWindow>
