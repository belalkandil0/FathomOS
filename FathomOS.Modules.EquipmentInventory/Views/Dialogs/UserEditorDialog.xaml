<mah:MetroWindow x:Class="FathomOS.Modules.EquipmentInventory.Views.Dialogs.UserEditorDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:converters="clr-namespace:FathomOS.Modules.EquipmentInventory.Converters"
        Title="{Binding DialogTitle}"
        Height="750" Width="700"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        ShowInTaskbar="False"
        Background="{DynamicResource BackgroundBrush}"
        BorderBrush="{DynamicResource AccentBrush}"
        BorderThickness="1">
    
    <mah:MetroWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    </mah:MetroWindow.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource HeaderBrush}" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Profile Avatar -->
                <Border Grid.Column="0" Width="60" Height="60" CornerRadius="30" Margin="0,0,15,0">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#4CAF50" Offset="0"/>
                            <GradientStop Color="#2E7D32" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <iconPacks:PackIconMaterial Kind="Account" Width="30" Height="30"
                                                Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="{Binding DialogTitle}" FontSize="20" FontWeight="SemiBold"
                              Foreground="{DynamicResource TextPrimaryBrush}"/>
                    <TextBlock Text="Configure user account and permissions" FontSize="12"
                              Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Content with Tabs -->
        <TabControl Grid.Row="1" Margin="15" 
                    Background="Transparent" BorderThickness="0">
            
            <!-- Account Tab -->
            <TabItem Header="Account">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <!-- Account Information -->
                        <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="ACCOUNT INFORMATION" FontSize="11" FontWeight="SemiBold" 
                                          Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,15"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="15"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="0">
                                        <TextBlock Text="Username *" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="2">
                                        <TextBlock Text="Employee ID" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding EmployeeId, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,12,0,0">
                                        <TextBlock Text="Email *" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding Email, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,12,0,0">
                                        <TextBlock Text="Role *" Style="{DynamicResource FieldLabel}"/>
                                        <ComboBox ItemsSource="{Binding AvailableRoles}" SelectedItem="{Binding SelectedRole}"
                                                 DisplayMemberPath="Name"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Password Section (New Users) -->
                        <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15"
                               Visibility="{Binding IsNewUser, Converter={StaticResource BoolToVisibility}}">
                            <StackPanel>
                                <TextBlock Text="INITIAL PASSWORD" FontSize="11" FontWeight="SemiBold" 
                                          Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,15"/>
                                
                                <Border Background="#2000D4AA" CornerRadius="8" Padding="12" Margin="0,0,0,15">
                                    <StackPanel Orientation="Horizontal">
                                        <iconPacks:PackIconMaterial Kind="InformationOutline" Width="16" Height="16"
                                                                    Foreground="{DynamicResource AccentBrush}"
                                                                    VerticalAlignment="Top" Margin="0,2,10,0"/>
                                        <TextBlock Text="A temporary password will be generated. The user must change it on first login."
                                                  TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                </Border>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Temporary Password" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding TemporaryPassword}" IsReadOnly="True"
                                                Background="{DynamicResource SurfaceBrush}" FontFamily="Consolas"/>
                                    </StackPanel>
                                    
                                    <Button Grid.Column="1" Content="Generate" Command="{Binding GeneratePasswordCommand}"
                                           Style="{DynamicResource SecondaryButton}" Margin="10,18,0,0" VerticalAlignment="Bottom"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Account Settings -->
                        <Border Style="{DynamicResource CardBorder}" Padding="20">
                            <StackPanel>
                                <TextBlock Text="ACCOUNT SETTINGS" FontSize="11" FontWeight="SemiBold" 
                                          Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,15"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <mah:ToggleSwitch IsOn="{Binding IsActive}" Content="Account Active" Margin="0,0,0,10"/>
                                        <mah:ToggleSwitch IsOn="{Binding MustChangePassword}" Content="Must Change Password" Margin="0,0,0,10"/>
                                        <mah:ToggleSwitch IsOn="{Binding IsSuperAdmin}" Content="Super Administrator"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="1">
                                        <mah:ToggleSwitch IsOn="{Binding CanApproveManifests}" Content="Can Approve Manifests" Margin="0,0,0,10"/>
                                        <mah:ToggleSwitch IsOn="{Binding CanApproveDefects}" Content="Can Approve Defects" Margin="0,0,0,10"/>
                                    </StackPanel>
                                </Grid>
                                
                                <Grid Margin="0,15,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                        <TextBlock Text="Password Expires (Days)" Style="{DynamicResource FieldLabel}"/>
                                        <mah:NumericUpDown Value="{Binding PasswordExpiryDays}" Minimum="0" Maximum="365"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                        <TextBlock Text="Equipment Checkout Limit" Style="{DynamicResource FieldLabel}"/>
                                        <mah:NumericUpDown Value="{Binding EquipmentCheckoutLimit}" Minimum="0" Maximum="100"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Personal Tab -->
            <TabItem Header="Personal">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="PERSONAL INFORMATION" FontSize="11" FontWeight="SemiBold" 
                                          Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,15"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="15"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="0">
                                        <TextBlock Text="First Name" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding FirstName, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="2">
                                        <TextBlock Text="Last Name" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding LastName, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,12,0,0">
                                        <TextBlock Text="Phone" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding Phone, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,12,0,0">
                                        <TextBlock Text="Mobile Phone" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding MobilePhone, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,12,0,0">
                                        <TextBlock Text="Extension" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding Extension, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Professional Tab -->
            <TabItem Header="Professional">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel>
                        <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="EMPLOYMENT INFORMATION" FontSize="11" FontWeight="SemiBold" 
                                          Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,15"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="15"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="0">
                                        <TextBlock Text="Job Title" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding JobTitle, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="2">
                                        <TextBlock Text="Department" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding Department, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,12,0,0">
                                        <TextBlock Text="Division" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding Division, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,12,0,0">
                                        <TextBlock Text="Cost Center" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding CostCenter, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,12,0,0">
                                        <TextBlock Text="Office Location" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding OfficeLocation, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="2" Grid.Column="2" Margin="0,12,0,0">
                                        <TextBlock Text="Manager" Style="{DynamicResource FieldLabel}"/>
                                        <ComboBox ItemsSource="{Binding AvailableManagers}" SelectedItem="{Binding SelectedManager}"
                                                 DisplayMemberPath="DisplayName"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="3" Grid.Column="0" Margin="0,12,0,0">
                                        <TextBlock Text="Hire Date" Style="{DynamicResource FieldLabel}"/>
                                        <DatePicker SelectedDate="{Binding HireDate}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="3" Grid.Column="2" Margin="0,12,0,0">
                                        <TextBlock Text="Default Location" Style="{DynamicResource FieldLabel}"/>
                                        <ComboBox ItemsSource="{Binding AvailableLocations}" SelectedItem="{Binding SelectedLocation}"
                                                 DisplayMemberPath="Name"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- Certifications -->
                        <Border Style="{DynamicResource CardBorder}" Padding="20">
                            <StackPanel>
                                <TextBlock Text="CERTIFICATIONS &amp; TRAINING" FontSize="11" FontWeight="SemiBold" 
                                          Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,15"/>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="15"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="0">
                                        <TextBlock Text="Safety Training Expiry" Style="{DynamicResource FieldLabel}"/>
                                        <DatePicker SelectedDate="{Binding SafetyTrainingExpiry}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="0" Grid.Column="2">
                                        <TextBlock Text="Offshore Cert Expiry" Style="{DynamicResource FieldLabel}"/>
                                        <DatePicker SelectedDate="{Binding OffshoreCertExpiry}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,12,0,0">
                                        <TextBlock Text="Certifications" Style="{DynamicResource FieldLabel}"/>
                                        <TextBox Text="{Binding Certifications, UpdateSourceTrigger=PropertyChanged}"
                                                Style="{DynamicResource ModernTextBox}" TextWrapping="Wrap"
                                                AcceptsReturn="True" Height="60" VerticalContentAlignment="Top"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Notes Tab -->
            <TabItem Header="Notes">
                <Border Style="{DynamicResource CardBorder}" Padding="20" Margin="10">
                    <StackPanel>
                        <TextBlock Text="NOTES" FontSize="11" FontWeight="SemiBold" 
                                  Foreground="{DynamicResource TextSecondaryBrush}" Opacity="0.7" Margin="0,0,0,15"/>
                        
                        <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                Style="{DynamicResource ModernTextBox}" TextWrapping="Wrap"
                                AcceptsReturn="True" Height="200" VerticalContentAlignment="Top"
                                mah:TextBoxHelper.Watermark="Add any additional notes about this user..."/>
                    </StackPanel>
                </Border>
            </TabItem>
        </TabControl>
        
        <!-- Footer -->
        <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- Error Message -->
                <Border Grid.Column="0" Background="#33FF5252" CornerRadius="8" Padding="12,8" Margin="0,0,15,0"
                       Visibility="{Binding HasError, Converter={StaticResource BoolToVisibility}}">
                    <TextBlock Text="{Binding ErrorMessage}" Foreground="#FF5252" TextWrapping="Wrap" FontSize="12"/>
                </Border>
                
                <Button Grid.Column="1" Content="Cancel" IsCancel="True"
                       Click="CancelButton_Click"
                       Style="{DynamicResource SecondaryButton}"
                       Width="100" Margin="0,0,12,0"/>
                
                <Button Grid.Column="2" Content="{Binding SaveButtonText}" 
                       Command="{Binding SaveCommand}"
                       Style="{DynamicResource PrimaryButton}"
                       Width="140"/>
            </Grid>
        </Border>
    </Grid>
</mah:MetroWindow>
