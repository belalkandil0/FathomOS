<mah:MetroWindow x:Class="FathomOS.Modules.EquipmentInventory.Views.Dialogs.EquipmentEditorDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:converters="clr-namespace:FathomOS.Modules.EquipmentInventory.Converters"
        Title="{Binding WindowTitle}"
        Height="750" Width="900"
        MinHeight="600" MinWidth="800"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        ResizeMode="CanResizeWithGrip"
        Background="{DynamicResource BackgroundBrush}"
        BorderBrush="{DynamicResource AccentBrush}"
        BorderThickness="1"
        GlowBrush="{DynamicResource AccentBrush}">
    
    <mah:MetroWindow.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <converters:BytesToImageConverter x:Key="BytesToImageConverter"/>
    </mah:MetroWindow.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Main Content with Tabs -->
        <TabControl Grid.Row="0" Margin="10" Background="Transparent">
            
            <!-- Basic Info Tab -->
            <TabItem Header="Basic Info">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Left Column -->
                        <StackPanel Grid.Column="0" Margin="0,0,10,0">
                            <TextBlock Text="Asset Number" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding AssetNumber, UpdateSourceTrigger=PropertyChanged}" 
                                     IsReadOnly="{Binding IsNew, Converter={StaticResource InverseBoolConverter}}"
                                     mah:TextBoxHelper.Watermark="Auto-generated" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Unique ID (for labels)" Style="{DynamicResource FieldLabel}"/>
                            <Grid Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" 
                                         Text="{Binding UniqueId, UpdateSourceTrigger=PropertyChanged}" 
                                         mah:TextBoxHelper.Watermark="e.g., S7WSS04068"/>
                                <Button Grid.Column="1" Content="⟳" 
                                        Command="{Binding GenerateUniqueIdCommand}"
                                        ToolTip="Auto-generate Unique ID"
                                        Width="30" Margin="5,0,0,0" FontSize="14"/>
                            </Grid>
                            
                            <TextBlock Text="Name *" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                     mah:TextBoxHelper.Watermark="Equipment name" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Category" Style="{DynamicResource FieldLabel}"/>
                            <ComboBox ItemsSource="{Binding Categories}" 
                                      SelectedItem="{Binding SelectedCategory}"
                                      DisplayMemberPath="Name" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Type" Style="{DynamicResource FieldLabel}"/>
                            <ComboBox ItemsSource="{Binding Types}" 
                                      SelectedItem="{Binding SelectedType}"
                                      DisplayMemberPath="Name" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Manufacturer" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding Manufacturer, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Model" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding Model, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Serial Number" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding SerialNumber, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>
                        </StackPanel>
                        
                        <!-- Right Column -->
                        <StackPanel Grid.Column="1" Margin="10,0,0,0">
                            <TextBlock Text="SAP Number" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding SapNumber, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Tech Number" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding TechNumber, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Part Number" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding PartNumber, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Location" Style="{DynamicResource FieldLabel}"/>
                            <ComboBox ItemsSource="{Binding Locations}" 
                                      SelectedItem="{Binding SelectedLocation}"
                                      DisplayMemberPath="Name" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Project" Style="{DynamicResource FieldLabel}"/>
                            <ComboBox ItemsSource="{Binding Projects}" 
                                      SelectedItem="{Binding SelectedProject}"
                                      DisplayMemberPath="Name" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Status" Style="{DynamicResource FieldLabel}"/>
                            <ComboBox ItemsSource="{Binding StatusValues}" 
                                      SelectedItem="{Binding Status}" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Condition" Style="{DynamicResource FieldLabel}"/>
                            <ComboBox ItemsSource="{Binding ConditionValues}" 
                                      SelectedItem="{Binding Condition}" Margin="0,0,0,10"/>
                        </StackPanel>
                        
                        <!-- Description spanning both columns -->
                        <StackPanel Grid.Row="6" Grid.ColumnSpan="2" Margin="0,10,0,0">
                            <TextBlock Text="Description" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                                     Height="80" AcceptsReturn="True" TextWrapping="Wrap"
                                     VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>
            
            <!-- Physical Properties Tab -->
            <TabItem Header="Physical">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel MaxWidth="500" HorizontalAlignment="Left">
                        <TextBlock Text="DIMENSIONS" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Weight (kg)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding WeightKg}" Minimum="0" StringFormat="F2"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Length (cm)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding LengthCm}" Minimum="0" StringFormat="F1"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="1" Grid.Column="1" Margin="5,0,0,10">
                                <TextBlock Text="Width (cm)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding WidthCm}" Minimum="0" StringFormat="F1"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Row="2" Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Height (cm)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding HeightCm}" Minimum="0" StringFormat="F1"/>
                            </StackPanel>
                        </Grid>
                        
                        <Separator Margin="0,10"/>
                        
                        <TextBlock Text="PACKAGING" FontWeight="Bold" Margin="0,10,0,10"/>
                        
                        <TextBlock Text="Packaging Type" Style="{DynamicResource FieldLabel}"/>
                        <ComboBox SelectedItem="{Binding PackagingType}" Margin="0,0,0,10" Width="200" HorizontalAlignment="Left">
                            <ComboBoxItem Content=""/>
                            <ComboBoxItem Content="Box"/>
                            <ComboBoxItem Content="Crate"/>
                            <ComboBoxItem Content="Case"/>
                            <ComboBoxItem Content="Pallet"/>
                            <ComboBoxItem Content="Drum"/>
                            <ComboBoxItem Content="Container"/>
                            <ComboBoxItem Content="Bag"/>
                            <ComboBoxItem Content="None"/>
                        </ComboBox>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Package Weight (kg)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding PackagingWeightKg}" Minimum="0" StringFormat="F2"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                <TextBlock Text="Package Length (cm)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding PackagingLengthCm}" Minimum="0" StringFormat="F1"/>
                            </StackPanel>
                        </Grid>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Package Width (cm)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding PackagingWidthCm}" Minimum="0" StringFormat="F1"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                <TextBlock Text="Package Height (cm)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding PackagingHeightCm}" Minimum="0" StringFormat="F1"/>
                            </StackPanel>
                        </Grid>
                        
                        <TextBlock Text="Packaging Description" Style="{DynamicResource FieldLabel}"/>
                        <TextBox Text="{Binding PackagingDescription}" AcceptsReturn="True" TextWrapping="Wrap" 
                                 Height="60" VerticalScrollBarVisibility="Auto" Margin="0,0,0,10"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <TextBlock Text="CONSUMABLES" FontWeight="Bold" Margin="0,10,0,10"/>
                        
                        <CheckBox Content="This is a consumable item" IsChecked="{Binding IsConsumable}" Margin="0,0,0,10"/>
                        
                        <StackPanel Visibility="{Binding IsConsumable, Converter={StaticResource BoolToVisibility}}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                    <TextBlock Text="Quantity On Hand" Style="{DynamicResource FieldLabel}"/>
                                    <mah:NumericUpDown Value="{Binding QuantityOnHand}" Minimum="0"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                    <TextBlock Text="Unit of Measure" Style="{DynamicResource FieldLabel}"/>
                                    <TextBox Text="{Binding UnitOfMeasure}"/>
                                </StackPanel>
                            </Grid>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                    <TextBlock Text="Min Stock Level" Style="{DynamicResource FieldLabel}"/>
                                    <mah:NumericUpDown Value="{Binding MinimumStockLevel}" Minimum="0"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="5,0,5,10">
                                    <TextBlock Text="Reorder Level" Style="{DynamicResource FieldLabel}"/>
                                    <mah:NumericUpDown Value="{Binding ReorderLevel}" Minimum="0"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2" Margin="5,0,0,10">
                                    <TextBlock Text="Max Stock Level" Style="{DynamicResource FieldLabel}"/>
                                    <mah:NumericUpDown Value="{Binding MaximumStockLevel}" Minimum="0"/>
                                </StackPanel>
                            </Grid>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                    <TextBlock Text="Batch Number" Style="{DynamicResource FieldLabel}"/>
                                    <TextBox Text="{Binding BatchNumber}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                    <TextBlock Text="Lot Number" Style="{DynamicResource FieldLabel}"/>
                                    <TextBox Text="{Binding LotNumber}"/>
                                </StackPanel>
                            </Grid>
                            
                            <TextBlock Text="Expiry Date" Style="{DynamicResource FieldLabel}"/>
                            <DatePicker SelectedDate="{Binding ExpiryDate}" Width="200" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Certification & Calibration Tab -->
            <TabItem Header="Certification">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel MaxWidth="500" HorizontalAlignment="Left">
                        <TextBlock Text="CERTIFICATION" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <CheckBox Content="Requires Certification" IsChecked="{Binding RequiresCertification}" Margin="0,0,0,10"/>
                        
                        <StackPanel Visibility="{Binding RequiresCertification, Converter={StaticResource BoolToVisibility}}">
                            <TextBlock Text="Certification Number" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding CertificationNumber}" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Certification Body" Style="{DynamicResource FieldLabel}"/>
                            <TextBox Text="{Binding CertificationBody}" Margin="0,0,0,10"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                    <TextBlock Text="Certification Date" Style="{DynamicResource FieldLabel}"/>
                                    <DatePicker SelectedDate="{Binding CertificationDate}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                    <TextBlock Text="Expiry Date" Style="{DynamicResource FieldLabel}"/>
                                    <DatePicker SelectedDate="{Binding CertificationExpiryDate}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                        
                        <Separator Margin="0,20"/>
                        
                        <TextBlock Text="CALIBRATION" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <CheckBox Content="Requires Calibration" IsChecked="{Binding RequiresCalibration}" Margin="0,0,0,10"/>
                        
                        <StackPanel Visibility="{Binding RequiresCalibration, Converter={StaticResource BoolToVisibility}}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                    <TextBlock Text="Last Calibration" Style="{DynamicResource FieldLabel}"/>
                                    <DatePicker SelectedDate="{Binding LastCalibrationDate}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                    <TextBlock Text="Next Calibration Due" Style="{DynamicResource FieldLabel}"/>
                                    <DatePicker SelectedDate="{Binding NextCalibrationDate}"/>
                                </StackPanel>
                            </Grid>
                            
                            <TextBlock Text="Calibration Interval (days)" Style="{DynamicResource FieldLabel}"/>
                            <mah:NumericUpDown Value="{Binding CalibrationIntervalDays}" Minimum="1" Maximum="730" Width="150" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Procurement Tab -->
            <TabItem Header="Procurement">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel MaxWidth="500" HorizontalAlignment="Left">
                        <TextBlock Text="OWNERSHIP" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Ownership Type" Style="{DynamicResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding OwnershipTypeValues}" 
                                  SelectedItem="{Binding OwnershipType}" 
                                  Width="200" HorizontalAlignment="Left" Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Supplier" Style="{DynamicResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding Suppliers}" 
                                  SelectedItem="{Binding SelectedSupplier}"
                                  DisplayMemberPath="Name" Margin="0,0,0,10"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <TextBlock Text="PURCHASE DETAILS" FontWeight="Bold" Margin="0,10,0,10"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Purchase Date" Style="{DynamicResource FieldLabel}"/>
                                <DatePicker SelectedDate="{Binding PurchaseDate}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                <TextBlock Text="Warranty Expiry" Style="{DynamicResource FieldLabel}"/>
                                <DatePicker SelectedDate="{Binding WarrantyExpiryDate}"/>
                            </StackPanel>
                        </Grid>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Purchase Price" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding PurchasePrice}" Minimum="0" StringFormat="F2"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                <TextBlock Text="Currency" Style="{DynamicResource FieldLabel}"/>
                                <TextBox Text="{Binding PurchaseCurrency}" MaxLength="3"/>
                            </StackPanel>
                        </Grid>
                        
                        <TextBlock Text="Purchase Order Number" Style="{DynamicResource FieldLabel}"/>
                        <TextBox Text="{Binding PurchaseOrderNumber}" Margin="0,0,0,10"/>
                        
                        <!-- Rental Details (visible when rented) -->
                        <StackPanel Visibility="{Binding IsRented, Converter={StaticResource BoolToVisibility}}">
                            <Separator Margin="0,10"/>
                            
                            <TextBlock Text="RENTAL DETAILS" FontWeight="Bold" Margin="0,10,0,10"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                    <TextBlock Text="Rental Start" Style="{DynamicResource FieldLabel}"/>
                                    <DatePicker SelectedDate="{Binding RentalStartDate}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                    <TextBlock Text="Rental End" Style="{DynamicResource FieldLabel}"/>
                                    <DatePicker SelectedDate="{Binding RentalEndDate}"/>
                                </StackPanel>
                            </Grid>
                            
                            <TextBlock Text="Rental Rate" Style="{DynamicResource FieldLabel}"/>
                            <mah:NumericUpDown Value="{Binding RentalRate}" Minimum="0" StringFormat="F2" 
                                               Width="150" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Service & Maintenance Tab -->
            <TabItem Header="Service">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="10">
                    <StackPanel MaxWidth="500" HorizontalAlignment="Left">
                        <TextBlock Text="SERVICE SCHEDULE" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Last Service Date" Style="{DynamicResource FieldLabel}"/>
                                <DatePicker SelectedDate="{Binding LastServiceDate}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                <TextBlock Text="Next Service Due" Style="{DynamicResource FieldLabel}"/>
                                <DatePicker SelectedDate="{Binding NextServiceDate}"/>
                            </StackPanel>
                        </Grid>
                        
                        <TextBlock Text="Service Interval (Days)" Style="{DynamicResource FieldLabel}"/>
                        <mah:NumericUpDown Value="{Binding ServiceIntervalDays}" Minimum="0" Maximum="3650"
                                           Width="150" HorizontalAlignment="Left" Margin="0,0,0,10"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <TextBlock Text="INSPECTION" FontWeight="Bold" Margin="0,10,0,10"/>
                        
                        <TextBlock Text="Last Inspection Date" Style="{DynamicResource FieldLabel}"/>
                        <DatePicker SelectedDate="{Binding LastInspectionDate}" Margin="0,0,0,10"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <TextBlock Text="DEPRECIATION" FontWeight="Bold" Margin="0,10,0,10"/>
                        
                        <TextBlock Text="Depreciation Method" Style="{DynamicResource FieldLabel}"/>
                        <ComboBox SelectedItem="{Binding DepreciationMethod}" Margin="0,0,0,10" Width="200" HorizontalAlignment="Left">
                            <ComboBoxItem Content=""/>
                            <ComboBoxItem Content="Straight-Line"/>
                            <ComboBoxItem Content="Declining Balance"/>
                            <ComboBoxItem Content="Sum of Years Digits"/>
                            <ComboBoxItem Content="Units of Production"/>
                        </ComboBox>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0" Margin="0,0,5,10">
                                <TextBlock Text="Useful Life (Years)" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding UsefulLifeYears}" Minimum="0" Maximum="100"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="1" Margin="5,0,0,10">
                                <TextBlock Text="Residual Value" Style="{DynamicResource FieldLabel}"/>
                                <mah:NumericUpDown Value="{Binding ResidualValue}" Minimum="0" StringFormat="F2"/>
                            </StackPanel>
                        </Grid>
                        
                        <TextBlock Text="Current Value" Style="{DynamicResource FieldLabel}"/>
                        <mah:NumericUpDown Value="{Binding CurrentValue}" Minimum="0" StringFormat="F2"
                                           Width="200" HorizontalAlignment="Left"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Notes Tab -->
            <TabItem Header="Notes">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <StackPanel Grid.Row="0" Margin="0,0,0,10">
                        <TextBlock Text="Notes (visible to all)" Style="{DynamicResource FieldLabel}"/>
                        <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}" 
                                 AcceptsReturn="True" TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 Height="150"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Row="1">
                        <TextBlock Text="Internal Notes (admin only)" Style="{DynamicResource FieldLabel}"/>
                        <TextBox Text="{Binding InternalNotes, UpdateSourceTrigger=PropertyChanged}" 
                                 AcceptsReturn="True" TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 Height="150"/>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- QR Label Tab (NEW) -->
            <TabItem Header="QR Label">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Left: Settings -->
                    <StackPanel Grid.Column="0" Margin="0,0,20,0">
                        <TextBlock Text="UNIQUE ID" FontWeight="Bold" FontSize="14" Margin="0,0,0,15"/>
                        
                        <TextBlock Text="Unique ID (searchable, shown on label)" Style="{DynamicResource FieldLabel}"/>
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" 
                                     Text="{Binding UniqueId, UpdateSourceTrigger=PropertyChanged}"
                                     mah:TextBoxHelper.Watermark="e.g., S7WSS04068"/>
                            <Button Grid.Column="1" Content="Generate" 
                                    Command="{Binding GenerateUniqueIdCommand}"
                                    ToolTip="Auto-generate based on category"
                                    Width="80" Margin="10,0,0,0"/>
                        </Grid>
                        
                        <TextBlock Text="Format: {OrgCode}{CategoryCode}{Sequence}" 
                                   FontStyle="Italic" FontSize="11"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   Margin="0,0,0,20"/>
                        
                        <Separator Margin="0,0,0,20"/>
                        
                        <TextBlock Text="LABEL GENERATION" FontWeight="Bold" FontSize="14" Margin="0,0,0,15"/>
                        
                        <!-- Barcode Type Selection -->
                        <TextBlock Text="Barcode Type" Style="{DynamicResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding BarcodeTypeValues}"
                                  SelectedItem="{Binding SelectedBarcodeType}"
                                  Margin="0,0,0,15" Width="200" HorizontalAlignment="Left">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        
                        <TextBlock Text="The label will include:" Margin="0,0,0,10"/>
                        <StackPanel Margin="10,0,0,15">
                            <TextBlock Text="• Organization name (from Settings)" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="• Barcode/QR code with asset number + unique ID" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="• Unique ID displayed below code" Foreground="{DynamicResource TextSecondaryBrush}"/>
                        </StackPanel>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <Button Content="Generate Label" 
                                    Command="{Binding GenerateLabelCommand}"
                                    Style="{DynamicResource PrimaryButton}"
                                    Width="120" Margin="0,0,10,0">
                                <Button.ContentTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <iconPacks:PackIconMaterial Kind="QrcodeScan" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <TextBlock Text="Generate"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </Button.ContentTemplate>
                            </Button>
                            
                            <Button Content="View" 
                                    Command="{Binding ViewLabelCommand}"
                                    ToolTip="View label full size"
                                    Width="70" Margin="0,0,10,0"/>
                            
                            <Button Content="Save" 
                                    Command="{Binding SaveLabelCommand}"
                                    ToolTip="Save label to file"
                                    Width="70" Margin="0,0,10,0"/>
                            
                            <Button Content="Print" 
                                    Command="{Binding PrintLabelCommand}"
                                    Width="70"/>
                        </StackPanel>
                        
                        <TextBlock Text="{Binding StatusMessage}" 
                                   Foreground="{DynamicResource AccentBrush}"
                                   Margin="0,15,0,0"/>
                    </StackPanel>
                    
                    <!-- Right: Label Preview -->
                    <Border Grid.Column="1" 
                            BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="1" 
                            Background="White"
                            Width="250" Height="300"
                            CornerRadius="4">
                        <Grid>
                            <!-- Placeholder when no label -->
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                        Visibility="{Binding HasLabelPreview, Converter={StaticResource InverseBoolToVisibility}}">
                                <iconPacks:PackIconMaterial Kind="Qrcode" 
                                                           Width="64" Height="64" 
                                                           Foreground="LightGray"
                                                           HorizontalAlignment="Center"/>
                                <TextBlock Text="Label Preview" 
                                           Foreground="Gray" 
                                           HorizontalAlignment="Center"
                                           Margin="0,10,0,0"/>
                                <TextBlock Text="Click 'Generate Label'" 
                                           Foreground="LightGray" 
                                           FontSize="11"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Label Image when generated -->
                            <Image Source="{Binding LabelImageBytes, Converter={StaticResource BytesToImageConverter}}"
                                   Stretch="Uniform"
                                   Margin="5"
                                   Visibility="{Binding HasLabelPreview, Converter={StaticResource BoolToVisibility}}"/>
                        </Grid>
                    </Border>
                </Grid>
            </TabItem>
            
        </TabControl>
        
        <!-- Footer -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" 
                           VerticalAlignment="Center" 
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                
                <Button Grid.Column="1" Content="Cancel" 
                        Command="{Binding CancelCommand}"
                        Style="{DynamicResource SecondaryButton}"
                        Width="100" Margin="0,0,10,0"/>
                
                <Button Grid.Column="2" Content="Save" 
                        Command="{Binding SaveCommand}"
                        Style="{DynamicResource PrimaryButton}"
                        Width="100"/>
            </Grid>
        </Border>
        
        <!-- Loading Overlay -->
        <Border Grid.RowSpan="2" Background="#80000000" 
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibility}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <mah:ProgressRing IsActive="True" Width="60" Height="60"/>
                <TextBlock Text="Saving..." Foreground="White" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</mah:MetroWindow>
