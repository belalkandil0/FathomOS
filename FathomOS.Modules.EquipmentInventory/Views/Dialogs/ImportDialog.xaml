<mah:MetroWindow x:Class="FathomOS.Modules.EquipmentInventory.Views.Dialogs.ImportDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:converters="clr-namespace:FathomOS.Modules.EquipmentInventory.Converters"
        Title="Import Equipment"
        Height="550" Width="600"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        Background="{DynamicResource BackgroundBrush}"
        BorderBrush="{DynamicResource AccentBrush}"
        BorderThickness="1">
    
    <mah:MetroWindow.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
    </mah:MetroWindow.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <ScrollViewer Grid.Row="0" Padding="20" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <!-- File Selection -->
                <TextBlock Text="SELECT FILE" FontWeight="Bold" FontSize="12" Margin="0,0,0,10"/>
                
                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox Grid.Column="0" Text="{Binding FilePath}" IsReadOnly="True"
                             mah:TextBoxHelper.Watermark="Select an Excel file..."/>
                    <Button Grid.Column="1" Content="Browse" Command="{Binding BrowseCommand}"
                            Width="80" Margin="10,0,0,0"/>
                    <Button Grid.Column="2" Content="Template" Command="{Binding DownloadTemplateCommand}"
                            ToolTip="Download import template"
                            Width="80" Margin="10,0,0,0"/>
                </Grid>
                
                <Separator Margin="0,10,0,20"/>
                
                <!-- Options -->
                <TextBlock Text="OPTIONS" FontWeight="Bold" FontSize="12" Margin="0,0,0,10"/>
                
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <TextBlock Text="Header Row Number" Style="{DynamicResource FieldLabel}"/>
                        <mah:NumericUpDown Value="{Binding HeaderRowNumber}" Minimum="1" Maximum="20" Width="100" HorizontalAlignment="Left"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1">
                        <CheckBox Content="Update existing items" IsChecked="{Binding UpdateExisting}" Margin="0,20,0,0"
                                  ToolTip="If an item with the same asset number exists, update it instead of skipping"/>
                    </StackPanel>
                </Grid>
                
                <Grid Margin="0,15,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" Margin="0,0,10,0">
                        <TextBlock Text="Default Category" Style="{DynamicResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding Categories}" SelectedItem="{Binding DefaultCategory}"
                                  DisplayMemberPath="Name"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1">
                        <TextBlock Text="Default Location" Style="{DynamicResource FieldLabel}"/>
                        <ComboBox ItemsSource="{Binding Locations}" SelectedItem="{Binding DefaultLocation}"
                                  DisplayMemberPath="Name"/>
                    </StackPanel>
                </Grid>
                
                <Separator Margin="0,20,0,20"/>
                
                <!-- Results -->
                <TextBlock Text="RESULTS" FontWeight="Bold" FontSize="12" Margin="0,0,0,10"/>
                
                <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="10" MinHeight="120">
                    <ItemsControl ItemsSource="{Binding Messages}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" TextWrapping="Wrap" Margin="0,2"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Border>
                
            </StackPanel>
        </ScrollViewer>
        
        <!-- Footer -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" VerticalAlignment="Center"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                
                <Button Grid.Column="1" Content="Import" Command="{Binding ImportCommand}"
                        Style="{DynamicResource PrimaryButton}" Width="100" Margin="0,0,10,0"
                        Visibility="{Binding HasCompleted, Converter={StaticResource InverseBoolToVisibility}}"/>
                
                <Button Grid.Column="2" Content="Close" Command="{Binding CloseCommand}"
                        Style="{DynamicResource SecondaryButton}" Width="100"/>
            </Grid>
        </Border>
        
        <!-- Loading -->
        <Border Grid.RowSpan="2" Background="#80000000" 
                Visibility="{Binding IsBusy, Converter={StaticResource BoolToVisibility}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <mah:ProgressRing IsActive="True" Width="50" Height="50"/>
                <TextBlock Text="Importing..." Foreground="White" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</mah:MetroWindow>
